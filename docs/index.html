---

title: fastai implementation of Single Image Super-Resolution

keywords: fastai
sidebar: home_sidebar

summary: "How to use fastai for super resolution."
description: "How to use fastai for super resolution."
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>fastai is a very easy-to-use Deep Learning library.
I will explain how to make Databunch when performing Super-Resolution using fastai.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Abstract">Abstract<a class="anchor-link" href="#Abstract"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>How to create databunch for Super-Resolution.</li>
<li>Implementation of Super-Resolution.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-to-create-the-databunch">How to create the databunch<a class="anchor-link" href="#How-to-create-the-databunch"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="after-open-image">after open image<a class="anchor-link" href="#after-open-image"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">after_open_image</span><span class="p">(</span><span class="n">img</span><span class="p">:</span><span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">scale</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sizeup</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">crop</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">luminance</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; after_open function of ImageImageList &quot;&quot;&quot;</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span>
    <span class="k">if</span> <span class="n">scale</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="n">img</span> <span class="o">=</span> <span class="n">lr_image</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">sizeup</span><span class="o">=</span><span class="n">sizeup</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">crop</span><span class="p">:</span> <span class="n">img</span> <span class="o">=</span> <span class="n">crop_center_image</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">luminance</span><span class="p">:</span> <span class="n">img</span> <span class="o">=</span> <span class="n">split_luminance</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">img</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="x-data">x data<a class="anchor-link" href="#x-data"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="n">src</span> <span class="o">=</span> <span class="n">ImageImageList</span><span class="o">.</span><span class="n">from_folder</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">convert_mode</span><span class="o">=</span><span class="n">convert_mode</span><span class="p">,</span>
                                 <span class="n">after_open</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">after_open_image</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">in_size</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">sizeup</span><span class="o">=</span><span class="n">sizeup</span><span class="p">,</span> <span class="n">luminance</span><span class="o">=</span><span class="n">luminance</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="y-data">y data<a class="anchor-link" href="#y-data"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="n">src</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">label_from_func</span><span class="p">((</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">),</span> <span class="n">label_cls</span><span class="o">=</span><span class="n">ImageImageList</span><span class="p">,</span> <span class="n">convert_mode</span><span class="o">=</span><span class="n">convert_mode</span><span class="p">,</span>
                           <span class="n">after_open</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">after_open_image</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">out_size</span><span class="p">,</span> <span class="n">luminance</span><span class="o">=</span><span class="n">luminance</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="transformers">transformers<a class="anchor-link" href="#transformers"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_sr_transforms</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">max_lighting</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">p_lighting</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">xtra_tfms</span><span class="p">:</span><span class="n">Optional</span><span class="p">[</span><span class="n">Collection</span><span class="p">[</span><span class="n">Transform</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Collection</span><span class="p">[</span><span class="n">Transform</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot; trainsorms for super-resolution &quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="n">crop</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">max_lighting</span><span class="p">:</span>
        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">brightness</span><span class="p">(</span><span class="n">change</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">max_lighting</span><span class="p">),</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">max_lighting</span><span class="p">)),</span> <span class="n">p</span><span class="o">=</span><span class="n">p_lighting</span><span class="p">))</span>
        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">contrast</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">max_lighting</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">max_lighting</span><span class="p">)),</span> <span class="n">p</span><span class="o">=</span><span class="n">p_lighting</span><span class="p">))</span>
    <span class="c1">#       train                   , valid</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">res</span> <span class="o">+</span> <span class="n">listify</span><span class="p">(</span><span class="n">xtra_tfms</span><span class="p">),</span> <span class="p">[</span><span class="n">crop</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)])</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="x-transformer">x transformer<a class="anchor-link" href="#x-transformer"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">get_sr_transforms</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">in_size</span><span class="p">),</span> <span class="n">tfm_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="y-transformer">y transformer<a class="anchor-link" href="#y-transformer"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">transform_y</span><span class="p">(</span><span class="n">get_sr_transforms</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">out_size</span><span class="p">,</span> <span class="n">max_lighting</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="normalize">normalize<a class="anchor-link" href="#normalize"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">luminance</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">do_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">imagenet_stats</span><span class="p">,</span> <span class="n">do_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Implementations-of-Super-Resolution.">Implementations of Super-Resolution.<a class="anchor-link" href="#Implementations-of-Super-Resolution."> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>srcnn</li>
<li>epscn</li>
<li>srresnet</li>
<li>unet(fastai)</li>
<li>unet-floss(fastai)</li>
</ul>

</div>
</div>
</div>
</div>
 

